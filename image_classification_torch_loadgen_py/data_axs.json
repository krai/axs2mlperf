{
    "_parent_entries": [ [ "^", "byname", "python_script" ], [ "^", "byname", "base_loadgen_program" ] ],
    "_producer_rules": [
        [ [ "loadgen_output", "classified_imagenet", "framework=pytorch" ], [["get", "pipeline"]] ]
    ],

    "resolution": 224,

    "index_file": null,
    "preprocessed_images_query": [
        "preprocessed",
        "dataset_name=imagenet",
        [ "^^", "substitute", "resolution=#{resolution}#"],
        [ "^^", "substitute", "first_n=#{num_of_images}#"],
        [ "index_file", [ "^^", "get", "index_file" ]]
    ],
    "preprocessed_images_entry": [ "^", "byquery", [[ "^^", "get", "preprocessed_images_query" ]], {}, ["preprocessed_images_query"] ],
    "preprocessed_images_dir": [ "^^", "execute", [[
        [ "get", "preprocessed_images_entry" ],
        [ "get_path" ]
    ]] ],
    "input_file_list": [ "^^", "dig", "preprocessed_images_entry.input_file_list" ],

    "num_gpus": [ "^", "execute", [[
                        [ "byquery", "shell_tool,can_gpu" ],
                        [ "run"  ]
                ]]  ],

    "torchvision_query": [ "^^", "case", [ [ "^^", "get", "num_gpus"] , "0" ,["python_package", "package_name=torchvision"] ], {"default_value": ["python_package", "package_name=torchvision", "with_cuda"] } ],
    "loadgen_query":    [ "python_package", "package_name=mlperf_loadgen" ],

    "python_deps": [
        [ "^", "byquery", [[ "^^", "get", "torchvision_query" ]], {}, ["torchvision_query"] ],
        [ "^", "byquery", "data_loader,imagenet" ],
        [ "^", "byquery", [ [ "^^", "get", "loadgen_query" ] ], {}, ["loadgen_query"] ]
    ],

    "model_name": "resnet50",
    "model_query": [ "inference_ready", "pytorch_model", [ "^^", "substitute", "model_name=#{model_name}#" ] ],
    "model_entry": [ "^", "byquery", [[ "^^", "get", "model_query" ]], {}, ["model_query"] ],
    "model_path": [ "^^", "execute", [[
        [ "get", "model_entry" ],
        [ "get_path" ]
    ]] ],
    "batch_size": 1,
    "framework": "pytorch",
    "verbosity": 2,
    "num_of_images": ["^^", "get", "loadgen_dataset_size" ],

    "output_entry_parents": [ "AS^IS", "AS^IS", [ "^", "byname", "base_imagenet_loadgen_experiment" ] ],
    "output_entry_tags": [ "loadgen_output", "classified_imagenet" ],
    "output_entry_param_names": [
        "loadgen_scenario",
        "loadgen_mode",
        "loadgen_dataset_size",
        "loadgen_buffer_size",
        "loadgen_count_override",
        "loadgen_multistreamness",

        "framework",
        "sut_name",
        "program_name",
        "verbosity",

        "model_name",
        "model_path",
        "preprocessed_images_dir",
        "input_file_list",
        "batch_size",

        "retrained",
        "input_data_types",
        "weight_data_types",
        "weight_transformations",
        "url"
    ],

    "rel_script_path": "torch_loadgen_classifier.py",
    "script_extra_params": [ "^^", "get", "input_parameters_file_path" ]
}
