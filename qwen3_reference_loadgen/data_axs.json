{
    "_parent_entries": [ [ "^", "byname", "shell" ], [ "^", "byname", "base_loadgen_program" ] ],

    "_producer_rules": [
        [ [ "shell_tool", "can_benchmark_qwen3" ],
            [ [ "get_kernel" ], [ "byname", "pip" ], [ "install" ] ], {
                "package_name": "mlperf_inf_mm_q3vl",
                "desired_python_version": "3.12",
                "installable": [ "^", "execute", [[
                    [ "byquery", "git_repo,repo_name=mlperf_inference_git" ],
                    [ "get_path", "multimodal/qwen3-vl" ]
                ]] ],
                "newborn_parent_names": [ "base_pip_package", "python_in_shell" ],
                "python_deps": [
                    [ "AS^IS", "AS^IS", "AS^IS", "^^", "get", "__entry__" ]
                ],
		"exe_path": [ "AS^IS", "AS^IS", "AS^IS", "^^", "get_path", [ [ "^^", "execute", [[ ["get", "rel_bin_dir"], [ "__add__", [[ "mlperf-inf-mm-q3vl" ]] ] ]] ] ] ],

                "model_path": "/mnt/data/krai/mlperf-scratch-path/models/vlm_model/Qwen3-VL-235B-A22B-Instruct",
                "model_name": "Qwen/Qwen3-VL-235B-A22B-Instruct",
                "dataset": "Shopify/product-catalogue",
                "docker_image": "vllm/vllm-openai:v0.15.0-cu130",

                "shell_cmd_templates": {
                    "help": "#{exe_path}# --help",
                    "help_benchmark": "#{exe_path}# benchmark endpoint --help",
		    "server_cmd": "echo docker run --gpus all -v /mnt/data:/mnt/data -e TRITON_PTXAS_PATH=/usr/local/cuda/bin/ptxas -e PATH=/usr/local/cuda/bin:$PATH -e LD_LIBRARY_PATH=/usr/local/cuda/lib64:${LD_LIBRARY_PATH:-} -p 8000:8000 --ipc=host #{docker_image}# --served-model-name #{model_name}# --model #{model_path}# --tensor-parallel-size 8 --limit-mm-per-prompt.video 0 --no-enable-prefix-caching",
                    "benchmark": "#{exe_path}# benchmark endpoint --dataset.repo_id #{dataset}# --settings.test.scenario #{lc_scenario}# --settings.test.mode #{lc_mode}# --settings.logging.log_output.outdir #{output_dir}#",
                    "accuracy_report": "#{exe_path}# evaluate --dataset.repo_id #{dataset}# --filename #{accuracy_log_path}#"
                },
                "cmd_key": "help"
            }
        ],
        [ [ "loadgen_output", "task=qwen3", "framework=reference" ], [["get", "pipeline"]] ]
    ],

    "loadgen_scenario": "Offline",

    "lc_scenario": [ "^^", "execute", [[
        [ "get", "loadgen_scenario" ],
        [ "lower" ]
    ]] ],
    "lc_mode": [ "^^", "case", [
        [ "^^", "get", "loadgen_mode" ],
        "AccuracyOnly", "accuracy_only",
        "PerformanceOnly", "performance_only"
    ] ],

    "output_entry_parents": [ "AS^IS", "AS^IS", [ "^", "byname", "base_loadgen_experiment" ] ],

    "pipeline": [ "^^", "execute", [[
        [ "get_kernel" ],
        [ "byquery", "shell_tool,can_benchmark_qwen3" ],
        [ "run", [], {
                "cmd_key": "benchmark",
                "lc_scenario": [ "^^", "get", "lc_scenario" ],
                "lc_mode": [ "^^", "get", "lc_mode" ],
                "output_dir": [ "^^", "get", "output_dir" ]
            } ],
        [],
        [ "get", "output_entry" ]
    ]] ]
}
